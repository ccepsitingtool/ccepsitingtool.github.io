<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">

  <title>CCEP | Vote Center Siting Tool</title>
  
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
        integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
        crossorigin=""/>
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/county_select_style.css" />
    <script src="data/california_counties.js"></script>

</head>

<body>




<div class="navbar navbar-default">
  <div class="col-lg-12 col-sm-12 test">
    
    <a style="padding: 20px 0"class="navbar-brand" href="http://ccep.ucdavis.edu/">
      <img src="assets/ccep_logo.png" alt="California Civic Engagement Project (CCEP)">
    </a>





<!--     <h1>Vote Center Siting Tool</h1>

    <p class="intro">
      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
    </p> -->

  </div>
</div>

<div class="row clearfix" style="width: 100%; overflow-x: hidden;">
  
      <div id="content-wrapper" class="col-lg-7 col-md-7 col-sm-7" style="overflow-y: scroll">

      <div id="county_context">

        <h1> Vote Center Siting Tool</h1>
        <p>  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>

        <h2>County Selection</h2>
        <p>  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>

        <h3>Currently Available Counties</h3>
        <ul id='county_list'>
        </ul>

      </div>
    </div>


    <div id="content-wrapper" class="col-lg-5 col-md-5 col-sm-5 ">

      <div id="county_leaflet_map"></div>

      <div id="source">
        <h3 id="sources" class="panel-title">
          Sources
        </h3>
        <a id="source-title"></a>
      </div>

    </div>

</div>

<div class="footer">
  <center>
    <a href="">
      Methodology
    </a>

    |
        <a href="">
      More Information on the Purpose of the Siting Tool
    </a>
    |
        <a href="">
      Acknowledgments
    </a>
    
  </center>
</div>

<!-- Libraries needed -->
<script src="js/jquery.min.js"
        type="text/javascript"></script>


<!-- Leaflet related -->
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
        integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
        crossorigin=""></script>



<script type="text/javascript">
  function adjustSizing() {
    var wdh = $(window).height();
    var nbh = $('.navbar').height();
    var bottomBarH = 30 
    $('#county_leaflet_map').height(wdh - nbh - bottomBarH);
    $('#county_context').height(wdh - nbh - bottomBarH);
  }

  // First call it once on page load
  adjustSizing();

  // Then bind it to be called every time the page window is changed in size
  $(window).resize(adjustSizing);
</script>

<!-- Global variables -->
<script type="text/javascript">
  var countyContext = L.control();
  var availableCounties ={};
  var availableCountiesKeys = [];
  var countiesLayer;
function processCSV(data) {
  var allTextLines = data.split(/\r\n|\n/);
  var headers = allTextLines[0].split(',');
  var lines = [];

  for (var i=1; i < allTextLines.length; i++) {
    var data = allTextLines[i].split(',');
    if (data.length == headers.length) {

      // Create an object for each row
      var tarr = {};
      for (var j = 0; j < headers.length; j++) {
        var h = headers[j].replace(/"/g, '');
        var v = data[j].replace(/"/g, '');
        tarr[h] = v;
      }

      // Push each JSON to a list
      lines.push(tarr);
    }
  }
  return lines;
}


// Leaflet Map Stuff
var countyMap = L.map('county_leaflet_map', {zoomControl: false}).setView([37.7, -119.7], 6);
// countyMap.removeControl(countyMap.zoomControl);
// We will need to replace the accessToken before releasing (since
// you are just using mine right now)
L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoia3VhbmIiLCJhIjoidXdWUVZ2USJ9.qNKXXP6z9_fKA8qrmpOi6Q', {
  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
  maxZoom: 6,
  minZoom: 6,
  id: 'mapbox.streets',
  accessToken: 'pk.eyJ1Ijoia3VhbmIiLCJhIjoidXdWUVZ2USJ9.qNKXXP6z9_fKA8qrmpOi6Q'
}).addTo(countyMap);
countyMap.dragging.disable();


// countyMap.setMaxBounds(bounds);
function createMapInterfaces(){

  countyContext.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'leafletMapBLBox');
    this.update();
    return this._div;
    };

  countyContext.update = function (props) {
    if (props != undefined && (availableCountiesKeys.indexOf(props['countyfp']) > -1 ) ){
      var hasVoteSitePage =  '<span style="color:steelblue">Click County to See Vote Sites</span>' 
      } else {
      var hasVoteSitePage =  '<span style="color:red">Vote Sites Not Yet Available</span>'
    }
    
    this._div.innerHTML = '<h4>County Name</h4>' +  (props ?
      '<span class="countyTitle">' + props.name + '</span>'  + hasVoteSitePage
      : 'Hover over a county');
  };
}

function addCountiesToMap(california_counties) {

 // Polygon Options - Add the polygon layers
  var options = {
    style: function(feature) {
      var countyId = feature.properties['countyfp']
      return {
        fillColor: availableCountiesKeys.indexOf(countyId) > -1 ? 'yellow' : 'white',
        weight: 1,
        opacity: .5,
        color: 'black',
        fillOpacity:  .5
      }
    },
    onEachFeature:  function(feature, layer) {
      layer.on({
        mouseover:  function(e) {
                        var layer = e.target;

                        layer.setStyle({
                          weight: 5,
                          color: 'black',
                          dashArray: '',
                          fillOpacity: 0.15 
                        });

                        if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                          layer.bringToFront();
                        }

                        countyContext.update(layer.feature.properties);
                      } ,
        mouseout:   function resetHighlight(e) {
                          countiesLayer.resetStyle(e.target);
                          countyContext.update();
  },
        click:  function (e) {
            var countyId = e.target.feature.properties['countyfp']

            if (availableCountiesKeys.indexOf(countyId) > -1 ) {
              window.open(availableCounties[countyId].url,'_self');
            }
            
      }
      });
    }
  };
  // Add to Map
  countiesLayer = L.geoJson(california_counties, options);
  countiesLayer.addTo(countyMap);
}

// Check Available Counties Create Map Interfaces, Update Maps
 $.ajax({
    type: 'GET',
    url: `data/available_counties.csv`,
    dataType: 'text',
    success: function(data) {
    processCSV(data).forEach(function(line) {
      //Save Line Data to Point Object
      availableCounties[line['id']] = line
      availableCountiesKeys.push(line['id'])
    })
    availableCountiesKeys = availableCountiesKeys.sort()

    availableCountiesKeys.forEach(function(listItem) {
      var listHtml = '<li> <a href="' + availableCounties[listItem].url + '">' +availableCounties[listItem].name + '</a></li>'
      $('#county_list').append(listHtml)
    })
    createMapInterfaces()
    countyContext.addTo(countyMap);
    addCountiesToMap(california_counties)
    }
  });

</script>



<!-- Remaining carry-over libraries -->
<script src="js/queue.v1.min.js"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>

</body>
</html>
